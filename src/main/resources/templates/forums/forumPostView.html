<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Biryani&family=Peralta&family=Ubuntu+Condensed&display=swap" rel="stylesheet">
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.0.0/mdb.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="icon" type="image/png" href="/favicon.png">

</head>
<body>
<nav id="nav" class="navbar navbar-expand-lg navbar-light bg-white d-flex sticky-top" th:fragment="navBar"
     xmlns:sec="http://www.w3.org/1999/xhtml">
    <!-- Container wrapper -->
    <div class="container">
        <!-- Navbar brand -->
        <a class="navbar-brand me-2" href="/">Project HandMeDown</a>

        <!-- Toggle button -->
        <button
                class="navbar-toggler"
                type="button"
                data-mdb-toggle="collapse"
                data-mdb-target="#navbarButtonsExample"
                aria-controls="navbarButtonsExample"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <i class="fas fa-bars"></i>
        </button>

        <!-- Collapsible wrapper -->
        <div sec:authorize="isAnonymous()" class="collapse navbar-collapse" id="navbarButtonsExample">
            <!-- Left links -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <!--                <li class="nav-link"><a class="" th:href="@{/sign-up}">Register</a></li>-->
                <li class="nav-item"><a class="nav-link" th:href="@{/listings}">Marketplace</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/forum}">Forum</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/activities}">Activities</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/about}">About Us</a></li>
                <!--                <li class="nav-link"><a class="" th:href="@{/login}">Login</a></li>-->
            </ul>
            <!-- Left links -->
            <div class="d-flex align-items-center">
                <form th:action="@{/sign-up}" th:method="get">
                    <button type="submit" class="btn btn-link me-3">
                        Register
                    </button>
                </form>
                <form th:action="@{/login}" th:method="get">
                    <button type="submit" class="btn btn-link px-3 me-2">
                        Login
                    </button>
                </form>
            </div>
        </div>
        <div sec:authorize="isAuthenticated()" class="collapse navbar-collapse" id="navbarButtonsExample">
            <!-- Left links -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <!--                <li class="nav-link"><a class="" th:href="@{/sign-up}">Register</a></li>-->
                <li class="nav-item"><a class="nav-link" th:href="@{/listings}">Marketplace</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/forum}">Forum</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/activities}">Activities</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/about}">About Us</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/profile}">Profile</a></li>
                <!--                <li class="nav-link"><a class="" th:href="@{/login}">Login</a></li>-->
            </ul>
            <!-- Left links -->
            <div class="d-flex align-items-center">
                <form th:action="@{/logout}" th:method="post">
                    <button type="submit" class="btn btn-link px-3 me-2">
                        Logout
                    </button>
                </form>
            </div>
        </div>
        <!-- Collapsible wrapper -->
    </div>
    <!-- Container wrapper -->
</nav>

<div class="container">
    <div class="topic_wrapper">
        <div class="topic_box">
            <!--    breadcrumb-->
            <nav style="margin-top: 0.5em;" aria-label="breadcrumb">
                <ol class="breadcrumb mb-0" style="background-color: #fff">
                    <li class="breadcrumb-item"><a th:href="@{'/forum'}">Forum</a></li>
                    <li class="breadcrumb-item active" aria-current="page" th:text="${posts.title}"></li>
                </ol>
            </nav>
<!--            breadcrumb end-->
            <div class="topic_signature_area">
                <h1>
					<span class="ipsType_break ipsContained">
						<span style="word-wrap: break-word; word-break: break-word; font-weight: 600; font-size: 28px; line-height: 1.2; letter-spacing: -.02em; color: #313131;" th:text="${posts.title}">
                            <!--title of topic-->
                        </span>
					</span>
                </h1>
                <ul class="ipsTags ipsList_inline p-0">
                    <li class="topic_cats_list" style="background: lightgrey;
            color: rgb(255,255,255) !important;
            font-size: 11px;
            vertical-align: middle;
            line-height: 20px;
            padding: 0 12px;
            margin: 0 2px 0 2px;
            display: inline-block;
            border-radius: 50px;
            letter-spacing: 0;
            font-weight: normal;" th:each="cat : ${categories}">
                        <a th:href="@{/FilterByCategory/{cat_id}(cat_id=${cat.getId()})}">
                            <span th:text="${cat.name}"><!--category tags--></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <hr>
    </div>
    <div class="col-md-12 thread">
        <div class="panel">
            <div class="panel-body one">
                <div class="media-block">
                    <!--                    This will be the area of the topic title-->
                </div>
                <!-- Newsfeed Content -->
                <!--===================================================-->
                <div class="media-block" style="position: relative;right: 50px;">
                    <a class="media-left" href="#">
                        <span th:if="${posts.user.getUserIMG() != null}">
                            <img class="avatar img-fluid" alt="Profile Picture" style="height: 250px;" th:src="${posts.user.getUserIMG()}">
                        </span>
                    </a>
                    <div class="media-body">
                        <div id="topic_creator_signature" class="mar-btm">
                            <a id="topic_author" href="#" class="btn-link text-semibold media-heading box-inline"
                               th:text="${posts.getUser().getUsername()}">
                                <!--username of post author-->
                            </a>,&nbsp;
                            <time class="text-muted text-sm" th:text="${posts.timestamp}">
                                <!--timestamp here-->
                            </time>
                        </div>
                        <p th:text="${posts.body}">
                            <!--body of topic post-->
                        </p>
                        <div class="pad-ver">
                            <!--link for comment creation page-->
                            <a class="btn btn-sm btn-default btn-hover-primary" href="#comment_form">
                                Add comment
                            </a>
                            <a class="btn btn-sm btn-default btn-hover-primary"
                               th:if="${posts.user.getId() == user.getId()}"
                               th:href="@{/edit/{id}/post(id=${posts.id})}">
                                Edit Post
                            </a>
                            <span sec:authorize="hasAuthority('ADMIN')">
                                <a class="btn btn-trans btn-icon add-tooltip"
                                   th:href="@{/admin/post/{id}/delete(id=${posts.id})}">
                                    Admin Delete Post
                                </a>
                                <br>
                                <a class="btn btn-trans btn-icon add-tooltip"
                                   th:href="@{/admin/edit/{id}/post(id=${posts.id})}">
                                    Admin Edit Post
                                </a>
                            </span>
                        </div>
                        <hr>
                    </div>
                </div>
                <div class="panel-body two">
                    <!-- Reply feed Content -->
                    <!--===================================================-->
                    <div class="media-block">
                        <div class="media-body">

                            <!-- Comments -->
                            <div>
                                <div class="media-block" th:each="reply : ${replies}">
                                    <div style="position: relative; right: 25px;">
                                        <i class="fab fa-replyd"></i>
                                    </div>&nbsp;
                                    <!--                                user avatar image-->
                                    <a class="media-left" href="#">
                                        <span th:if="${reply.user.getUserIMG() != null}">
                                          <img class="avatar img-fluid" style="height: 150px;" th:src="@{${reply.user.getUserIMG()}}">
                                        </span>
                                    </a>
                                    <!--                                reply of user-->
                                    <div class="media-body">
                                        <div class="mar-btm" style="display: flex;">
                                            <a href="#" class="btn-link text-semibold media-heading box-inline"
                                               th:text="${reply.user.getUsername()}">
                                                <!--reply username-->
                                            </a>,&nbsp;
                                            <p class="text-muted text-sm" th:text="${reply.timestamp}">
                                                <!--timestamp-->
                                            </p>
                                        </div>
                                        <div><p th:text="${reply.body}"><!-- body of reply--></p></div>

                                        <div class="pad-ver">
                                            <a class="btn btn-trans btn-icon add-tooltip"
                                               th:if="${reply.user.getId() == user.getId()}"
                                               th:href="@{/edit/reply/{id}(id=${reply.getId()})}">
                                                Edit Comment
                                            </a>
                                            <a class="btn btn-trans text-danger add-tooltip"
                                               th:href="@{/report/{type}/{id}(type = 'forum_reply', id = ${reply.getId()})}">
                                                Report Comment
                                            </a>
                                            <span sec:authorize="hasAuthority('ADMIN')">
                                                <a th:href="@{/admin/reply/{id}/delete(id=${reply.id},action='show_all')}">Admin Delete Comment</a>
                                            </span>
                                        </div>
                                        <hr>
                                    </div>
                                </div>
                            </div> <!--reply population end-->
                        </div>
                    </div>
                    <!--=================== End Reply Feed Content ==============================-->
                </div>
            </div>
            <div class="panel">
                <div id="comment_form" class="panel-body">
                    <form style="margin-bottom: 2em;" th:action="@{/create/reply/{id}(id=${posts.getId()})}" method="post" th:object="${reply}">
                        <textarea style="margin-bottom: .25em;" class="form-control" rows="4" name="message" th:field="*{body}" required></textarea>
                        <button class="btn-primary pull-right" type="submit">Post Reply</button>
                    </form>
                    <div class="mar-top clearfix">
                        <a class="btn btn-trans add-tooltip" th:href="@{'/forum'}">Go back to
                        forum</a>
                        <a class="btn btn-trans text-danger add-tooltip"
                           th:href="@{/report/{type}/{id}(type = 'forum_post', id = ${posts.getId()})}">Report Post</a>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- thread end -->
</div> <!-- container end -->

<!--ORIGINAL VIEW-->
<!--    topic-->
<!--    <div>-->
<!--        <h3 th:text="${posts.getTitle()}"></h3>-->
<!--        <p th:text="${posts.getBody()}"></p>-->
<!--        <h5><span th:text="${posts.getUser().getUsername()}">username</span></h5>-->
<!--        <span th:if="${posts.user.getId() == user.getId()}"><a th:href="@{/edit/{id}/post(id=${posts.id})}"><sup>edit</sup></a></span>&nbsp;-->
<!--        <div sec:authorize="hasAuthority('ADMIN')">-->
<!--            <a th:href="@{/post/{id}/delete(id=${posts.id})}">Admin Delete Post</a>-->
<!--            <br>-->
<!--            <a th:href="@{/edit/{id}/post(id=${posts.id})}">Admin Edit Post</a>-->
<!--        </div>-->
<!--    </div>-->
<!--    <p>Tags: &nbsp;</p>-->
<!--    <ul th:each="category : ${categories}">-->
<!--        <a th:href="@{/FilterByCategory/{cat_id}(cat_id=${category.getId()})}">-->
<!--            <li th:text="${category.getName()}"></li>-->
<!--        </a>-->
<!--    </ul>-->

<!--&lt;!&ndash;    replies&ndash;&gt;-->
<!--    <div  th:each="reply : ${replies}">-->
<!--        <p th:text="${reply.body}"></p>-->
<!--        <p th:text="${reply.timestamp}"></p>-->
<!--        <h4 th:text="${reply.forumPost.getId()}" ></h4>-->
<!--        <p th:text="${reply.user.getUsername()}"></p>-->
<!--        <span sec:authorize="hasAuthority('ADMIN')">-->
<!--            <a th:href="@{/reply/{id}/delete(id=${reply.id},action='show_all')}">Admin Delete Comment</a>-->
<!--        </span>-->
<!--        <button><a th:href="@{/report/{type}/{id}(type = 'forum_reply', id = ${reply.getId()})}">Report Reply</a></button>-->
<!--        <span th:if="${reply.user.getId() == user.getId()}"><a th:href="@{/edit/reply/{id}(id=${reply.getId()})}"><sup>edit</sup></a></span>&nbsp;-->
<!--    </div>-->
<!--    <br>-->

<!--    reply form-->
<!--    <form th:action="@{/create/reply/{id}(id=${posts.getId()})}" method="post" th:object="${reply}">-->
<!--        <textarea rows="12" cols="100" name="message" th:field="*{body}"></textarea><br>-->
<!--        <button type="submit">Submit Reply</button>-->
<!--    </form>-->
<!--    <button><a th:href="@{/report/{type}/{id}(type = 'forum_post', id = ${posts.getId()})}">Report Post</a></button>-->
<!--    <button><a th:href="@{'/forum'}">Go back to forum</a></button>-->
<!--</div>-->

<footer class="text-center text-white">
    <!-- Grid container -->
    <div class="container p-4"></div>
    <!-- Grid container -->

    <!-- Copyright -->
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        © 2020 Copyright:
        <a class="text-white" href="https://mdbootstrap.com/">MDBootstrap.com</a>
    </div>
    <!-- Copyright -->
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                 integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
                 crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/f98b77bf40.js" crossorigin="anonymous"></script> <!--icons-->
<!-- MDB -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.0.0/mdb.min.js"></script>
</body>
</html>